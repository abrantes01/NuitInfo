<div id="marks">

    <div class="topbar row">
        <div class="col-md-6">

          <ui-select ng-model="selected.room" theme="selectize" on-select="loadClassRoom()">
            <ui-select-match placeholder="{{ 'mark.placeholder-classroom' | translate }}">{{$select.selected.name }}</ui-select-match>
            <ui-select-choices repeat="item in rooms | filter: $select.search">
              <div ng-bind-html="item.name | highlight: $select.search"></div>
              <small ng-bind-html="item.description | highlight: $select.search"></small>
            </ui-select-choices>
          </ui-select>
        </div>
    </div>

    <div class="row" data-ng-show="selected.room">
        <div class="col-md-12">
            <div role="tabpanel">
                <ul class="nav nav-tabs nav-subjects" role="tablist">
                    <li data-ng-repeat="subject in subjects" data-ng-click="changeTab(subject.id)" ng-class="{active:isActive(subject.id)}">
                        <a role="tab" data-toggle="tab" href="javascript:;">
                            {{ subject.name }}
                            <i class="fa fa-times" data-ng-click="removeSubject(subject)"></i>
                        </a>
                    </li>

                    <li popover-placement="bottom" popover-template="linkPopover.subjectUrl" popover-append-to-body="true" popover-toggle="linkPopover.subjectOpen" data-ng-click="linkPopover.subjectOpen = !linkPopover.subjectOpen; $event.stopPropagation()">

                        <a href="javascript:;" role="tab" data-toggle="tab" class="add" tooltip-append-to-body="true" tooltip-trigger tooltip-placement="top" tooltip="{{ 'mark.add-tooltip' | translate }}">
                            + {{ 'mark.add-cta' | translate }}
                        </a>
                    </li>


                    <!-- Buttons to send marks -->

                    <li style="float:right">
                      <a href="javascript:;" data-ng-click="sendToAdmin()" class="mark-cta pull-left" tooltip-trigger tooltip-placement="top" tooltip="{{ 'mark.send-tooltip' | translate }}">
                        <img src="images/mark/send-icon.svg" alt="" width="16px">
                        &nbsp;{{ 'mark.send-cta' | translate }}
                      </a>

                      <a href="javascript:;" data-ng-click="exportExcel()" class="mark-cta pull-left" tooltip-trigger tooltip-placement="top" tooltip="{{ 'mark.download-tooltip' | translate }}">
                        <img src="images/mark/download-icon.svg" alt="" width="16px">
                        &nbsp;{{ 'mark.download-cta' | translate }}
                      </a>
                    </li>
                </ul>

                <div data-ng-if="subjects.length > 0">

                  <table class="table table-striped table-bordered table-hover marks-table">

                    <thead>
                      <tr>
                        <th align="left"><span class="value">{{ 'mark.fullName' | translate }}</span>
                        <th align="right" class="exam" data-ng-repeat="exam in exams">
                          {{ exam.name }} ({{ 'mark.coeff' | translate }} {{ exam.coefficient }})
                          <i class="fa fa-times" data-ng-click="removeExam(exam)"></i>
                        
                        <th class="add" tooltip-trigger tooltip-append-to-body="true" tooltip-placement="top" tooltip="{{ 'mark.new-exam-tooltip' | translate }}" popover-append-to-body="true" popover-placement="left" popover-template="linkPopover.examUrl" popover-toggle="linkPopover.examOpen" data-ng-click="linkPopover.examOpen = !linkPopover.examOpen; $event.stopPropagation()">
                            + {{ 'mark.add-cta' | translate }}
                        
                      
                    



                    <!-- STUDENTS AND MARKS -->

                    <tbody>
                      <tr data-ng-repeat="student in room.users" data-ng-if="student.type == 9">
                        <td class="displayName">
                          <a href="javascript:;">
                            {{ student.fullName }}
                          </a>
                        
                        <td data-ng-repeat="exam in exams">
                          <form><!-- data-ng-submit="addMark(student, exam, student.marks[$index], $event)">-->

                            <input data-ng-model="student.marks[$index].value" data-ng-keydown="keyDown(student, exam, student.marks[$index], $event)" ng-blur="addMark(student, exam, student.marks[$index], $event)" class="form-control">
                          </form>
                        
                      
                    


                  </table>
                </div>

            </div>
        </div>
    </div>

    <!-- POPOVER ADD SUBJECT -->

    <script type="text/ng-template" id="addSubject.html">
        <div ng-click="$event.stopPropagation()">

          <form action="javascript:;" data-ng-submit="addSubject()">
            <label>{{ 'mark.new-subject' | translate }}</label>
            <input type="text"
                   data-ng-model="subject.name"
                   class="form-control"
                   autofocus
                   select-on-hover style="width: 250px"
                   placeholder="{{ 'mark.placeholder-subject' | translate }}"/>

            <button type="submit" class="btn btn-success btn-add" style="margin-top: 10px;">{{ 'mark.add-cta' | translate }}</button>
          </form>
        </div>
    </script>


    <!-- POPOVER ADD EXAM -->

    <script type="text/ng-template" id="addExam.html">
        <div data-ng-click="$event.stopPropagation()">
            <form data-ng-submit="addExam(newExam)">

                <label>{{ 'mark.new-exam' | translate }}</label>

                <input type="text"
                       data-ng-model="newExam.name"
                       class="form-control"
                       autofocus
                       select-on-hover style="width: 250px"
                       placeholder="{{ 'mark.placeholder-exam' | translate }}"/>

                <input type="number"
                        id="coefficient"
                        class="form-control"
                        data-ng-model="newExam.coefficient"
                        select-on-hover style="width: 250px"
                        placeholder="{{ 'mark.placeholder-coeff' | translate }}"/>

                <button type="submit" class="btn btn-success">{{ 'mark.add-cta' | translate }}</button>

            </form>
        </div>
    </script>
</div>

<a id="dlink" style="display:none"></a>